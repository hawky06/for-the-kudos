<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>For the Kudos</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Leaflet CSS -->
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@mapbox/polyline@1.1.1/src/polyline.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 50px;
        }
        .card {
            margin: 20px auto;
            max-width: 500px;
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 40px;
        }
        .login-btn {
            display: block;
            margin: 50px auto;
        }
       #map{
        height: 300px;
        border-radius: 12px;
        margin-top: 15px;
       }
    </style>


</head>
<body>
    <div class="container">
        <h1>üèÉ‚Äç‚ôÇÔ∏è For the Kudos üèÉ‚Äç‚ôÄÔ∏è</h1>

        {% if stats %}
            <div class="card text-center shadow">
                <h2>Total Activities</h2>
                <p class="display-5">{{ stats.total_activities }}</p>
            </div>

            <div class="card text-center shadow">
                <h2>Total Kudos</h2>
                <p class="display-5">{{ stats.total_kudos }}</p>
            </div>

            <div class="card text-center shadow">
                <h2>Average Kudos per Activity</h2>
                <p class="display-5">{{ stats.average_kudos }}</p>
            </div>

            <div class="card text-center shadow">
                <h2>Most Loved Activity</h2>
                <p class="h4">{{ stats.most_loved_activity.name }}</p>
                <p class="text-muted">üìÖ {{ stats.most_loved_activity.date }}</p>
                <p>‚ù§Ô∏è {{ stats.most_loved_activity.kudos }} kudos</p>
                <p>üìè {{ stats.most_loved_activity.distance_km }} km</p>
                <!-- Map Container -->
                <div id="map"></div>
            </div>
            
            <script> 
                const encodedPolyline = "{{ stats.most_loved_activity.polyline }}";

                if (encodedPolyline) {
                    const coords = polyline.decode(encodedPolyline);
                    const latlngs = coords.map(c => [c[0], c[1]]);

                    const map = L.map('map');
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap'
                    }).addTo(map);

                    const route = L.polyline(latlngs, { weight: 4 }).addTo(map);
                    map.fitBounds(route.getBounds());
                }
            </script>

        {% else %}
            <div class="text-center mt-5"></div>
                <a href="/login" class="btn btn-primary btn-lg login-btn">Login with Strava to see your stats</a>
            </div>
        {% endif %}
    </div>
</body>
</html>
